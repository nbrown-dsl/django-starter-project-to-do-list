<!--html template with django code snippets-->


{% extends 'base.html' %}
{% load static %}
{%load crispy_forms_tags %}

{% block title %}My Skills{% endblock %}


{% block content %}
    
    
    <h2 class="display-6">My <em><span class="count">{{ count }}</span></em> skills</h2>
    
    <form action="/mycomps/" method="POST">
      
       {% csrf_token %}
       
      <div class="form-row">
        
       <div class="form-group col-md-4">
        {{ form.description.errors }}
        <!-- <label for="{{ form.description.id_for_label }}">Description:</label> -->
        {{ form.description }}
       </div>
       
        <div class="form-group col-md-2">
         {{ form.system.errors }}
         <!-- <label for="{{ form.system.id_for_label }}">System:</label> -->
         {{ form.system }}
        </div>
       
        
          <div class="form-group col-md-1">
          {{ form.grade.errors }}
          <!-- <label for="{{ form.grade.id_for_label }}">Grade:</label> -->
          {{ form.grade }}       
          </div>
        
        
          <div class="form-group col-md-1">
            <button class="btn btn-primary" type="submit">Filter</button>
            <a role="button" class="btn btn-secondary" href="{% url 'mycomps' %}">Clear</a>
         </div>
        
      </div>
       
      
    </form>
    <br>
    

  <!-- <table class="table table-dark">
            
      {% for obj in objects %}         
              <tr><td>
                
                <div class="btn-group" role="group" aria-label="Basic example">
               <label class="container"> 
                  {% if obj.userGrade.value > 0 %}<input class="star" type="checkbox" id="check{{obj.id}}" usertask_id = "{{ obj.id }}" grade_value=1  checked >
                  {% else %} 
                  <input class="star" type="checkbox" id="check{{obj.id}}" usertask_id = "{{ obj.id }}" grade_value=1  unchecked >
                   {% endif %}
                  <span class="starmark"></span>
                </label>
                <label class="container">
                  {% if obj.userGrade.value > 1 %}<input class="star" type="checkbox" id="check{{obj.id}}" usertask_id = "{{ obj.id }}" grade_value=2  checked >
                  {% else %} 
                  <input class="star" type="checkbox" id="check{{obj.id}}" usertask_id = "{{ obj.id }}" grade_value=2 unchecked >
                   {% endif %}
                  <span class="starmark"></span>
                </label>
                <label class="container">
                  {% if obj.userGrade.value > 2 %}<input class="star" type="checkbox" id="check{{obj.id}}" usertask_id = "{{ obj.id }}" grade_value=3  checked >
                  {% else %} 
                  <input class="star" type="checkbox" id="check{{obj.id}}" usertask_id = "{{ obj.id }}" grade_value=3  unchecked >
                   {% endif %}
                  <span class="starmark"></span>
                </label>
              </div>
                
                
              </td>                 
                  <td style="width:85%">{{obj.usertasktask.description}} </td>
                  <td>                
                    <div class="btn-group" role="group" aria-label="Basic example">
                    <label class="container"> 
                      {% if obj.upvote %}<input class="vote" type="checkbox" id="count{{obj.id}}" usertask_id="{{ obj.id }}" checked >
                      {% else %} 
                      <input class="vote" type="checkbox" id="count{{obj.id}}" usertask_id = "{{ obj.id }}" unchecked >
                      {% endif %}
                      <span class="starmark"></span>
                    </label>                    
                  </div>                   
                  </td> 
                  <td id="votes{{obj.id}}">{{obj.usertasktask.votes}} </td>
                  <td><center><a href="{{ obj.usertasktask.link}}" target="_blank"><i class="bi bi-info-square"></i></a></center></td>
                  <td><center><a href="{{ obj.usertasktask.system.link}}" target="_blank"><img src="{% static obj.usertasktask.system.imgFileName %}" width="24"></i></a></center></td>
              </tr>
      {% endfor %}
  </table> -->
  
  <div class="row row-cols-1 row-cols-md-6">
    {% for obj in objects %} 
    
     <div class="col p-3">
       
      <div class="card h-100">
        
        <div class="h-5 card-header justify-content-between btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
          <div><a href="{{ obj.usertasktask.system.link}}" target="_blank"><img src="{% static obj.usertasktask.system.imgFileName %}" width="24"></i></a></div>
          <div><a href="{{ obj.usertasktask.link}}" target="_blank"><i class="bi bi-info-square"></i></a></div>
        </div>
        
        
          <div class="card-body">
          <p class="card-text lead" data-bs-toggle="tooltip" data-bs-placement="top" title="{{obj.usertasktask.description}}">{{obj.usertasktask.name}}</p>
          
        </div>
        <div class="h-5 card-footer">
          
            <div class="btn-toolbar justify-content-between" role="toolbar" aria-label="Toolbar with button groups">
              <div class="btn-group" role="group" aria-label="Basic example">
                <!-- <label class="container">  -->
                
                    {% if obj.upvote %}
                  <!-- <input class="vote form-check-input" type="checkbox" id="count{{obj.id}}" usertask_id="{{ obj.id }}" checked > -->
                  <a href="javascript:code stuff"><i id="count{{obj.id}}" class="bi bi-hand-thumbs-up-fill vote upvote" usertask_id = "{{ obj.id }}" ></i></a>
                
                  {% else %} 
                  <!-- <input class="vote form-check-input" type="checkbox" id="count{{obj.id}}" usertask_id = "{{ obj.id }}" unchecked > -->
                  <a href="javascript:code stuff" ><i id="count{{obj.id}}" class="bi bi-hand-thumbs-up-fill vote" usertask_id = "{{ obj.id }}" ></i></a>
                
                  {% endif %}
                
                  <!-- <span class="starmark"></span> 
                  
                </label>  -->
                <p id="votes{{obj.id}}">{{obj.usertasktask.votes}}</p>
              </div>
              <div class="btn-group" role="group" aria-label="Basic example">
                <i class="bi bi-people-fill"></i><p id="usersCompleted{{obj.id}}">{{ obj.usertasktask.usersCompleted }}</p>&nbsp;&nbsp;
              <div >
                {% if obj.userGrade.value > 0 %}
                <a href="javascript:code stuff" ><i class="bi bi-trophy-fill star completed" usertask_id = "{{ obj.id }}" grade_value=1></i></a>
                {% else %}
                <a href="javascript:code stuff" data-toggle="tooltip" data-placement="bottom" title="Click to show completed"><i class="bi bi-trophy-fill star" usertask_id = "{{ obj.id }}" grade_value=0></i></a>
                {% endif %}
              </div>
              </div>
            </div>
                             
          </div> 
         </div>  
        </div>
        
    {% endfor %}
    <div class="col p-3">
       
      <div class="card h-100">      
        
    
          <div class="card-body">
            <div class="d-flex justify-content-center">
            <a href="{% url 'renderForm' 'Task' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Add skill" >
              <i class="bi bi-plus-circle-fill"></i>
            </a>
            </div>
          </div>
        
         </div>  
        </div>
  </div>




<!--ajax call to server to update grade change without reloading page-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script type="text/javascript">
  $('.star').click(function(){
  var grade_val;
  var usertask_id;
  usertask_id = $(this).attr("usertask_id");
  grade_val = $(this).attr("grade_value");
  if (grade_val==0) {
  $(this).addClass("completed");
  $(this).attr("grade_value",1);}
  else {
  $(this).removeClass("completed");
  $(this).attr("grade_value",0);  
  }
  $.ajax(
  {
      type:"GET",
      url: '/gradeChange/',
      data:{
               grade_value: grade_val,
               usertask_id: usertask_id
      },
      success: function( data ) 
      {
          // $( '#check'+ catid ).remove();
          // $( '#message' ).text(data);
          var dict = jQuery.parseJSON( data );
          $('.count').text(dict.userskillsCount)
          $('#usersCompleted'+ usertask_id).text(dict.usersCompleted)
      }
   })
  });
  // ajax call to server to update vote count without reloading page. returns updated count 
  $('.vote').click(function(){
  
  var task_id;
  task_id = $(this).attr("usertask_id");
  if ($(this).hasClass("upvote")) {
  $(this).removeClass("upvote");}
  else {
  $(this).addClass("upvote");  
  }
  $.ajax(
  {
      type:"GET",
      url: '/vote/',
      data:{
               
               task_id: task_id
      },
      success: function( data ) 
      {
          $( '#votes'+ task_id ).text(data);
          
      }
   })
  });

  
</script>

{% endblock %}